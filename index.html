
<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>نموذج تقرير حصص الانتظار – نسخة ويب</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD + Babel for in-browser JSX (good for GitHub Pages quick start) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <meta name="color-scheme" content="light dark">
  </head>
  <body class="bg-neutral-50 text-neutral-900">
    <div id="root"></div>

    <script type="text/babel">
      const DAYS = ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس"];

      function emptyRow() {
        return {
          day: "",
          date: "",
          grade: "",
          period: "",
          absentTeacher: "",
          executed: "",
          witness: "",
          domain: { basics: false, values: false, future: false },
        };
      }

      function newWeekTemplate() {
        return {
          id: `week-${Date.now()}`,
          title: "تقرير تنفيذ حصص الاحتياط – أسبوع جديد",
          coordinator: "",
          principal: "",
          teacherName: "",
          rows: Array.from({ length: 5 }, (_, i) => ({ ...emptyRow(), day: DAYS[i] })),
        };
      }

      function Th({ children, className = "" }) {
        return <th className={`text-start px-3 py-2 text-xs font-semibold border-b ${className}`}>{children}</th>;
      }
      function Td({ children, className = "" }) {
        return <td className={`px-2 py-2 align-top ${className}`}>{children}</td>;
      }

      function ReportApp() {
        const [weeks, setWeeks] = React.useState(() => {
          const saved = localStorage.getItem("report-weeks-v1");
          if (saved) {
            try { return JSON.parse(saved); } catch { return [newWeekTemplate()]; }
          }
          return [newWeekTemplate()];
        });
        const [schoolName, setSchoolName] = React.useState(() => localStorage.getItem("report-school") || "");

        React.useEffect(() => { localStorage.setItem("report-weeks-v1", JSON.stringify(weeks)); }, [weeks]);
        React.useEffect(() => { localStorage.setItem("report-school", schoolName); }, [schoolName]);

        const addWeek = () => setWeeks((w) => [...w, newWeekTemplate()]);
        const removeWeek = (id) => setWeeks((w) => w.filter((wk) => wk.id !== id));
        const addRow = (weekId) => {
          setWeeks((w) => w.map((wk) => wk.id === weekId ? { ...wk, rows: [...wk.rows, emptyRow()] } : wk));
        };
        const removeRow = (weekId, idx) => {
          setWeeks((w) => w.map((wk) => wk.id === weekId ? { ...wk, rows: wk.rows.filter((_, i) => i !== idx) } : wk));
        };
        const setWeekField = (weekId, field, value) => {
          setWeeks((w) => w.map((wk) => (wk.id === weekId ? { ...wk, [field]: value } : wk)));
        };
        const setCell = (weekId, idx, path, value) => {
          setWeeks((w) =>
            w.map((wk) => {
              if (wk.id !== weekId) return wk;
              const rows = [...wk.rows];
              const row = { ...rows[idx] };
              if (path.startsWith("domain.")) {
                const key = path.split(".")[1];
                row.domain = { ...row.domain, [key]: value };
              } else {
                row[path] = value;
              }
              rows[idx] = row;
              return { ...wk, rows };
            })
          );
        };

        const printableDate = React.useMemo(() => new Date().toLocaleDateString("ar-SA"), []);

        return (
          <div dir="rtl" className="min-h-screen bg-neutral-50 text-neutral-900 p-4 md:p-8">
            <header className="max-w-6xl mx-auto mb-6 print:mb-2">
              <div className="flex items-center justify-between gap-4 print:hidden">
                <h1 className="text-2xl md:text-3xl font-extrabold tracking-tight">نموذج تقرير حصص الانتظار – نسخة ويب</h1>
                <div className="flex items-center gap-2">
                  <button onClick={() => window.print()} className="px-3 py-2 rounded-xl shadow text-sm font-semibold bg-white hover:bg-neutral-100 border">طباعة / PDF</button>
                  <button onClick={addWeek} className="px-3 py-2 rounded-xl shadow text-sm font-semibold bg-white hover:bg-neutral-100 border">إضافة أسبوع</button>
                </div>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4 print:grid-cols-3">
                <div className="bg-white p-3 rounded-2xl border shadow-sm">
                  <label className="block text-xs font-medium text-neutral-600 mb-1">اسم المدرسة</label>
                  <input value={schoolName} onChange={(e)=>setSchoolName(e.target.value)} placeholder="مثال: الثانوية السادسة والعشرون" className="w-full rounded-xl border px-3 py-2 text-sm" />
                </div>
                <div className="bg-white p-3 rounded-2xl border shadow-sm">
                  <div className="text-xs font-medium text-neutral-600 mb-1">تاريخ الطباعة</div>
                  <div className="text-sm font-semibold">{printableDate}</div>
                </div>
                <div className="bg-white p-3 rounded-2xl border shadow-sm">
                  <div className="text-xs font-medium text-neutral-600 mb-1">ملاحظات عامة</div>
                  <div className="text-xs text-neutral-500">يتم حفظ المدخلات محليًا على جهازك تلقائيًا.</div>
                </div>
              </div>
            </header>

            <main className="max-w-6xl mx-auto space-y-8">
              {weeks.map((wk) => (
                <section key={wk.id} className="bg-white rounded-2xl border shadow-sm overflow-hidden">
                  <div className="flex items-center justify-between p-4 border-b print:p-3">
                    <input
                      value={wk.title}
                      onChange={(e)=>setWeekField(wk.id, "title", e.target.value)}
                      className="text-lg md:text-xl font-bold w-full bg-transparent outline-none"
                    />
                    <div className="flex items-center gap-2 print:hidden ms-3">
                      <button onClick={() => addRow(wk.id)} className="px-3 py-2 rounded-xl text-xs font-semibold bg-neutral-800 text-white hover:bg-neutral-700">+ صف</button>
                      <button onClick={() => addWeek()} title="نسخ أسبوع جديد" className="px-3 py-2 rounded-xl text-xs font-semibold bg-neutral-200 hover:bg-neutral-300">+ أسبوع</button>
                      {weeks.length > 1 && (
                        <button onClick={() => removeWeek(wk.id)} className="px-3 py-2 rounded-xl text-xs font-semibold bg-red-50 text-red-600 hover:bg-red-100">حذف الأسبوع</button>
                      )}
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-3 p-4 border-b print:p-3">
                    <div className="flex gap-2 items-center">
                      <label className="text-sm text-neutral-700 shrink-0">المنسقة:</label>
                      <input value={wk.coordinator} onChange={(e)=>setWeekField(wk.id, "coordinator", e.target.value)} className="flex-1 rounded-xl border px-3 py-2 text-sm" />
                    </div>
                    <div className="flex gap-2 items-center">
                      <label className="text-sm text-neutral-700 shrink-0">مديرة المدرسة:</label>
                      <input value={wk.principal} onChange={(e)=>setWeekField(wk.id, "principal", e.target.value)} className="flex-1 rounded-xl border px-3 py-2 text-sm" />
                    </div>
                    <div className="flex gap-2 items-center">
                      <label className="text-sm text-neutral-700 shrink-0">المعلمة:</label>
                      <input value={wk.teacherName} onChange={(e)=>setWeekField(wk.id, "teacherName", e.target.value)} className="flex-1 rounded-xl border px-3 py-2 text-sm" />
                    </div>
                  </div>

                  <div className="overflow-auto">
                    <table className="w-full text-sm">
                      <thead className="bg-neutral-100 text-neutral-700">
                        <tr>
                          <Th>اليوم</Th>
                          <Th>التاريخ</Th>
                          <Th>الصف</Th>
                          <Th>الحصة</Th>
                          <Th>المعلمة الغائبة</Th>
                          <Th>ما تم تنفيذه</Th>
                          <Th>الشاهد</Th>
                          <Th>
                            <div className="leading-tight">
                              <div className="font-semibold">المجال</div>
                              <div className="text-[11px] text-neutral-500">اختر واحدًا أو أكثر</div>
                            </div>
                          </Th>
                          <Th className="print:hidden">إجراءات</Th>
                        </tr>
                      </thead>
                      <tbody>
                        {wk.rows.map((r, idx) => (
                          <tr key={idx} className="border-b align-top">
                            <Td>
                              <select value={r.day} onChange={(e)=>setCell(wk.id, idx, "day", e.target.value)} className="w-full border rounded-lg px-2 py-1">
                                <option value=""></option>
                                {DAYS.map((d) => (<option key={d} value={d}>{d}</option>))}
                              </select>
                            </Td>
                            <Td>
                              <input type="date" value={r.date} onChange={(e)=>setCell(wk.id, idx, "date", e.target.value)} className="w-full border rounded-lg px-2 py-1" />
                            </Td>
                            <Td>
                              <input value={r.grade} onChange={(e)=>setCell(wk.id, idx, "grade", e.target.value)} placeholder="مثال: 1/أ" className="w-full border rounded-lg px-2 py-1" />
                            </Td>
                            <Td>
                              <input value={r.period} onChange={(e)=>setCell(wk.id, idx, "period", e.target.value)} placeholder="مثال: الرابعة" className="w-full border rounded-lg px-2 py-1" />
                            </Td>
                            <Td>
                              <input value={r.absentTeacher} onChange={(e)=>setCell(wk.id, idx, "absentTeacher", e.target.value)} placeholder="اسم المعلمة" className="w-full border rounded-lg px-2 py-1" />
                            </Td>
                            <Td>
                              <textarea value={r.executed} onChange={(e)=>setCell(wk.id, idx, "executed", e.target.value)} placeholder="وصف مختصر لما تم تنفيذه" className="w-full border rounded-lg px-2 py-1 min-h-[44px]"></textarea>
                            </Td>
                            <Td>
                              <textarea value={r.witness} onChange={(e)=>setCell(wk.id, idx, "witness", e.target.value)} placeholder="الشاهد/الدليل" className="w-full border rounded-lg px-2 py-1 min-h-[44px]"></textarea>
                            </Td>
                            <Td>
                              <div className="space-y-1">
                                <label className="flex items-center gap-2 text-xs">
                                  <input type="checkbox" checked={r.domain.basics} onChange={(e)=>setCell(wk.id, idx, "domain.basics", e.target.checked)} />
                                  <span>المهارات الأساسية</span>
                                </label>
                                <label className="flex items-center gap-2 text-xs">
                                  <input type="checkbox" checked={r.domain.values} onChange={(e)=>setCell(wk.id, idx, "domain.values", e.target.checked)} />
                                  <span>القيم والمواطنة الصالحة</span>
                                </label>
                                <label className="flex items-center gap-2 text-xs">
                                  <input type="checkbox" checked={r.domain.future} onChange={(e)=>setCell(wk.id, idx, "domain.future", e.target.checked)} />
                                  <span>مهارات المستقبل</span>
                                </label>
                              </div>
                            </Td>
                            <Td className="print:hidden">
                              <div className="flex gap-2">
                                <button onClick={() => removeRow(wk.id, idx)} className="px-2 py-1 rounded-lg text-xs bg-red-50 text-red-600 border hover:bg-red-100">حذف</button>
                              </div>
                            </Td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  <footer className="p-4 grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div className="bg-neutral-50 rounded-xl border p-3">
                      <div className="text-xs text-neutral-600 mb-2">توقيع المنسقة</div>
                      <div className="h-16 border rounded-lg"></div>
                    </div>
                    <div className="bg-neutral-50 rounded-xl border p-3">
                      <div className="text-xs text-neutral-600 mb-2">توقيع المعلمة</div>
                      <div className="h-16 border rounded-lg"></div>
                    </div>
                    <div className="bg-neutral-50 rounded-xl border p-3">
                      <div className="text-xs text-neutral-600 mb-2">توقيع مديرة المدرسة</div>
                      <div className="h-16 border rounded-lg"></div>
                    </div>
                  </footer>
                </section>
              ))}
            </main>

            <style>{`
              @media print {
                .print\\:hidden { display: none !important; }
                .print\\:mb-2 { margin-bottom: 0.5rem !important; }
                .print\\:p-3 { padding: 0.75rem !important; }
              }
              table { border-collapse: separate; border-spacing: 0; }
              thead th { position: sticky; top: 0; z-index: 1; }
            `}</style>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<ReportApp />);
    </script>
  </body>
</html>
