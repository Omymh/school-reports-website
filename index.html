<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تقرير حصص الانتظار – الثانوية السادسة والعشرون (تبوك)</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: "Tajawal", sans-serif;
      background: #f6faf8;
      color: #263b33;
      line-height: 1.6;
      overflow-x: hidden; /* إصلاح الحواف */
    }
    .container { max-width: 1100px; margin: 20px auto; padding: 0 15px; }

    /* ديباجة */
    .banner img { max-width: 100%; border-radius: 10px; display: block; margin: auto; }

    /* أزرار */
    .toolbar { display: flex; justify-content: space-between; flex-wrap: wrap; margin: 15px 0; gap: 10px; }
    .btn { padding: 10px 16px; border-radius: 10px; font-weight: 700; cursor: pointer; border: none; }
    .btn-primary { background: #28a745; color: #fff; }

    /* جدول */
    .card { background: #fff; border-radius: 12px; padding: 15px; margin-top: 20px; box-shadow: 0 2px 8px rgba(0,0,0,.05); }
    .card h3 { margin: 0 0 10px; font-weight: 800; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #d9e6de; padding: 8px; text-align: center; }
    th { background: #f3f7f5; }

    /* الشواهد */
    .witness-section { margin-top: 15px; }
    .witness-upload { display: flex; gap: 10px; flex-wrap: wrap; }
    .witness-upload img { width: 100px; height: 100px; object-fit: cover; border: 1px solid #ccc; border-radius: 8px; }

    /* للطباعة */
    @media print {
      .toolbar, .no-print { display: none !important; }
      @page { size: A4 landscape; margin: 10mm; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ديباجة -->
    <div class="banner">
      <img src="26.png" alt="ديباجة التقرير">
    </div>

    <!-- أزرار -->
    <div class="toolbar no-print">
      <button id="addWeekBtn" class="btn btn-primary">إضافة أسبوع</button>
      <button id="exportBtn" class="btn btn-primary">تصدير PDF</button>
    </div>

    <!-- تقارير -->
    <div id="weeks"></div>

    <!-- تذييل -->
    <div class="footer no-print" style="margin-top:20px;text-align:center;color:#204c3d;">
      <p>مديرة المدرسة: <strong>أماني آل عبشان</strong></p>
      <p>تصميم الهيئة الإدارية: <strong>عيدة صلاح</strong>، <strong>منيرة العمراني</strong></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    const weeksEl = document.getElementById("weeks");
    document.getElementById("addWeekBtn").addEventListener("click", addWeek);
    document.getElementById("exportBtn").addEventListener("click", exportPDF);

    function addWeek(){
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>أسبوع جديد</h3>
        <table>
          <thead>
            <tr>
              <th>#</th><th>اليوم</th><th>التاريخ</th><th>الصف</th><th>الحصة</th><th>المعلمة الغائبة</th><th>ما تم تنفيذه</th><th>المجال</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>1</td><td>الأحد</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
            <tr><td>2</td><td>الاثنين</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
            <tr><td>3</td><td>الثلاثاء</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
            <tr><td>4</td><td>الأربعاء</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
            <tr><td>5</td><td>الخميس</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          </tbody>
        </table>

        <!-- قسم الشواهد -->
        <div class="witness-section">
          <h4>الشواهد (حتى 3 صور)</h4>
          <input type="file" accept="image/*" multiple onchange="previewWitness(this, this.nextElementSibling)" />
          <div class="witness-upload"></div>
        </div>
      `;
      weeksEl.appendChild(card);
    }

    function previewWitness(input, container){
      container.innerHTML = "";
      const files = Array.from(input.files).slice(0,3); // فقط 3 صور
      files.forEach(file=>{
        const reader = new FileReader();
        reader.onload = e=>{
          const img = document.createElement("img");
          img.src = e.target.result;
          container.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    }

    async function exportPDF(){
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("l","mm","a4");
      const cards = document.querySelectorAll(".card");
      let first = true;

      for(let card of cards){
        const canvas = await html2canvas(card,{scale:1.2});
        const img = canvas.toDataURL("image/png");
        const imgProps = pdf.getImageProperties(img);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        if(!first) pdf.addPage();
        pdf.addImage(img,"PNG",0,0,pdfWidth,pdfHeight);
        first = false;
      }
      pdf.save("تقرير-حصص-الانتظار.pdf");
    }
  </script>
</body>
</html>
