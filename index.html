<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تقرير حصص الانتظار – الثانوية السادسة والعشرون (تبوك)</title>

  <!-- مظهر وهوية خضراء (من ملفك مع تبسيط لضمان الثبات) -->
  <style>
    :root{
      --primary: #28a745;
      --secondary: #20c997;
      --accent: #28a745;
      --accent-dark: #1e7e34;
      --ink: #2d3436;
      --ink-soft: #4d5b57;
      --border: #dee2e6;
      --border-light: #e9ecef;
      --paper: #ffffff;
      --background: #f8f9fa;
      --banner-bg: linear-gradient(135deg, #28a745, #20c997);
      --banner-ink: #ffffff;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{background:var(--background);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif;line-height:1.6}

    .container{max-width:1200px;margin:20px auto;padding:0 16px}
    .banner{background:var(--banner-bg);color:var(--banner-ink);padding:24px 28px;border-radius:22px;display:flex;align-items:center;justify-content:space-between;gap:16px;box-shadow:var(--shadow)}
    .title{font-weight:800;font-size:1.9rem;text-align:center;flex:1}
    .subtitle{opacity:.9;font-weight:500;font-size:.95rem;margin-top:6px}

    .btn{appearance:none;border:0;border-radius:14px;padding:10px 16px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:.2s}
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;box-shadow:0 6px 18px rgba(40,167,69,.28)}
    .btn-primary:hover{transform:translateY(-2px)}
    .btn-danger{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca}
    .btn-danger:hover{background:#fecaca}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    .card{background:#fff;border:1px solid var(--border-light);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
    .card-header{padding:16px 18px;border-bottom:1px solid var(--border-light);background:linear-gradient(135deg,#f8f9fa,#ffffff)}
    .card-body{padding:18px}

    .teacher-bar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .teacher-input{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--border-light);border-radius:12px;padding:10px 12px}
    .teacher-input label{white-space:nowrap;color:var(--ink-soft);font-weight:700}
    .teacher-input input{min-width:260px;padding:10px 12px;border:2px solid var(--border);border-radius:10px;outline:0;text-align:center}

    /* جدول واضح ومحاذاة وسط */
    .table-wrap{border:1px solid var(--border-light);border-radius:14px;overflow:hidden;box-shadow:var(--shadow)}
    table{border-collapse:separate;border-spacing:0;width:100%;background:var(--paper)}
    thead th{position:sticky;top:0;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;z-index:5;font-weight:800}
    th,td{border-right:1px solid var(--border-light);border-bottom:1px solid var(--border-light);padding:12px 10px;text-align:center;vertical-align:middle}
    th:first-child,td:first-child{border-right:none}
    td{color:var(--ink)}
    tbody tr:nth-child(even) td{background:#f9fbfa}
    tbody tr:hover td{background:#eef7f1}

    /* حقول بيضاء ونص أخضر داكن، وسط */
    input,select,textarea{width:100%;border:2px solid var(--border-light);border-radius:10px;background:#fff;color:var(--ink);padding:9px 12px;text-align:center;outline:0;font-size:.95rem}
    input:focus,select:focus,textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(40,167,69,.08)}
    textarea{min-height:54px;resize:vertical;text-align:right;padding-right:12px}
    input[type="checkbox"]{width:auto;border:none;accent-color:var(--primary)}
    .domain-col{display:flex;flex-direction:column;gap:8px;align-items:stretch}
    .domain-col label{display:flex;align-items:center;gap:8px;padding:8px 10px;background:#f7faf8;border:1px solid var(--border-light);border-radius:10px;font-size:.9rem}

    .row-actions{display:flex;justify-content:center}

    /* طباعة: الديباجة + الجدول فقط */
    @media print{
      .no-print{display:none!important}
      body{background:#fff!important}
      .container{margin:0;max-width:none;padding:0}
      .banner,.card{border-radius:0;box-shadow:none}
      thead th{background:#eee!important;color:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}
      th,td{border:1px solid #000!important}
      table{border:2px solid #000}
    }
  </style>

  <!-- مكتبات PDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">

    <!-- ديباجة العرض + زر التصدير (لا تُطبع) -->
    <div class="banner no-print" id="viewBanner">
      <div class="title">
        الثانوية السادسة والعشرون - تبوك
        <div class="subtitle">نظام تقارير حصص الانتظار</div>
      </div>
      <div class="toolbar">
        <button id="exportBtn" class="btn btn-primary">تصدير PDF</button>
      </div>
    </div>

    <!-- شريط اسم المعلمة (عرض فقط) -->
    <div class="card no-print" style="margin-top:18px">
      <div class="card-header">
        <div class="teacher-bar">
          <div class="teacher-input">
            <label for="teacherName">اسم المعلمة:</label>
            <input id="teacherName" />
          </div>
          <div class="toolbar">
            <button id="addRowBtn" class="btn btn-primary">+ صف</button>
          </div>
        </div>
      </div>
    </div>

    <!-- منطقة التصدير/الطباعة: الديباجة + الجدول -->
    <div id="exportArea" style="margin-top:18px">
      <div class="banner" id="printBanner">
        <div class="title">الثانوية السادسة والعشرون - تبوك</div>
        <div style="width:120px"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="card-body">
          <div class="table-wrap">
            <table id="reportTable">
              <thead>
              <tr>
                <th>#</th>
                <th>اليوم</th>
                <th>التاريخ</th>
                <th>الصف</th>
                <th>الحصة</th>
                <th>المعلمة الغائبة</th>
                <th>ما تم تنفيذه</th>
                <th>الشاهد</th>
                <th>المجال</th>
                <th class="no-print">إجراءات</th>
              </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- تذليل (عرض فقط) -->
    <div class="no-print" style="margin-top:18px;color:#60756e">
      <hr style="border:none;border-top:1px solid var(--border)" />
      <div>مديرة المدرسة: <strong>أماني آل عبشان</strong></div>
      <div>تصميم الهيئة الإدارية: <strong>عيدة صلاح</strong>، <strong>منيرة العمراني</strong></div>
    </div>
  </div>

  <script>
    (function(){
      const DAYS = ["","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس"];
      const LS_KEY = "sr-v6-stable";

      const tbody = document.getElementById("tbody");
      const addRowBtn = document.getElementById("addRowBtn");
      const teacherName = document.getElementById("teacherName");
      const exportBtn = document.getElementById("exportBtn");

      function load(){
        try{
          const s = localStorage.getItem(LS_KEY);
          return s ? JSON.parse(s) : { teacherName:"", rows: initRows() };
        }catch{ return { teacherName:"", rows: initRows() }; }
      }
      function save(data){ localStorage.setItem(LS_KEY, JSON.stringify(data)); }
      function initRows(){
        // 5 صفوف افتراضية لأيام الأسبوع
        return [1,2,3,4,5].map(i => ({
          day: DAYS[i], date:"", grade:"", period:"", absentTeacher:"", executed:"", witness:"", domain:{ basics:false, values:false, future:false }
        }));
      }

      let state = load();
      teacherName.value = state.teacherName || "";
      teacherName.addEventListener("input", () => { state.teacherName = teacherName.value; save(state); });

      function render(){
        tbody.innerHTML = "";
        if(!state.rows || state.rows.length === 0){ state.rows = initRows(); save(state); }

        state.rows.forEach((row, idx) => {
          const tr = document.createElement("tr");

          tr.appendChild(textCell(String(idx+1)));

          // اليوم
          tr.appendChild(selectCell(DAYS, row.day, v => { row.day = v; save(state); }));

          // التاريخ
          tr.appendChild(inputDateCell(row.date, v => { row.date = v; save(state); }));

          // الحقول النصية
          tr.appendChild(inputCell(row.grade, v => { row.grade = v; save(state); }));
          tr.appendChild(inputCell(row.period, v => { row.period = v; save(state); }));
          tr.appendChild(inputCell(row.absentTeacher, v => { row.absentTeacher = v; save(state); }));

          // ما تم تنفيذه / الشاهد
          tr.appendChild(textareaCell(row.executed, v => { row.executed = v; save(state); }));
          tr.appendChild(textareaCell(row.witness, v => { row.witness = v; save(state); }));

          // المجال
          const domTd = document.createElement("td");
          domTd.innerHTML = "";
          domTd.appendChild(check("المهارات الأساسية", row.domain.basics, v => { row.domain.basics = v; save(state); }));
          domTd.appendChild(check("القيم والمواطنة الصالحة", row.domain.values, v => { row.domain.values = v; save(state); }));
          domTd.appendChild(check("مهارات المستقبل", row.domain.future, v => { row.domain.future = v; save(state); }));
          tr.appendChild(domTd);

          // إجراءات (حذف صف)
          const actTd = document.createElement("td"); actTd.className = "no-print row-actions";
          const delBtn = document.createElement("button");
          delBtn.className = "btn btn-danger"; delBtn.textContent = "حذف";
          delBtn.addEventListener("click", () => { state.rows.splice(idx,1); save(state); render(); });
          actTd.appendChild(delBtn);
          tr.appendChild(actTd);

          tbody.appendChild(tr);
        });
      }

      // خلايا مساعدة
      function styleField(el){
        el.style.width="100%"; el.style.border="2px solid var(--border-light)"; el.style.borderRadius="10px";
        el.style.background="#fff"; el.style.color="var(--ink)"; el.style.padding="9px 12px"; el.style.textAlign="center"; el.style.outline="none";
      }
      function textCell(t){ const td=document.createElement("td"); td.textContent=t; return td; }
      function inputCell(val,on){ const td=document.createElement("td"); const i=document.createElement("input"); i.value=val||""; i.addEventListener("input",()=>on(i.value)); styleField(i); td.appendChild(i); return td; }
      function inputDateCell(val,on){ const td=document.createElement("td"); const i=document.createElement("input"); i.type="date"; i.value=val||""; i.addEventListener("input",()=>on(i.value)); styleField(i); td.appendChild(i); return td; }
      function textareaCell(val,on){ const td=document.createElement("td"); const ta=document.createElement("textarea"); ta.value=val||""; ta.addEventListener("input",()=>on(ta.value)); styleField(ta); ta.style.minHeight="56px"; ta.style.textAlign="right"; ta.style.paddingRight="12px"; td.appendChild(ta); return td; }
      function selectCell(options,val,on){ const td=document.createElement("td"); const s=document.createElement("select"); options.forEach(o=>{ const op=document.createElement("option"); op.value=o; op.textContent=o; if(o===val) op.selected=true; s.appendChild(op); }); s.addEventListener("change",()=>on(s.value)); styleField(s); td.appendChild(s); return td; }
      function check(label,checked,on){ const wrap=document.createElement("label"); wrap.className="domain-col-item"; wrap.style.display="flex"; wrap.style.alignItems="center"; wrap.style.gap="8px"; wrap.style.padding="8px 10px"; wrap.style.background="#f7faf8"; wrap.style.border="1px solid var(--border-light)"; wrap.style.borderRadius="10px"; const cb=document.createElement("input"); cb.type="checkbox"; cb.checked=!!checked; cb.addEventListener("change",()=>on(cb.checked)); const span=document.createElement("span"); span.textContent=label; wrap.appendChild(cb); wrap.appendChild(span); return wrap; }

      // إضافة صف
      document.getElementById("addRowBtn").addEventListener("click", () => {
        state.rows.push({ day:"", date:"", grade:"", period:"", absentTeacher:"", executed:"", witness:"", domain:{ basics:false, values:false, future:false } });
        save(state); render();
      });

      // تصدير PDF (يأخذ الديباجة + الجدول فقط)
      document.getElementById("exportBtn").addEventListener("click", async () => {
        const area = document.getElementById("exportArea");
        const canvas = await html2canvas(area, { scale: 2, useCORS: true });
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p","mm","a4");
        const img = canvas.toDataURL("image/jpeg", 0.95);
        const pageW=210, pageH=297;
        const imgW=pageW, imgH=(canvas.height*imgW)/canvas.width;
        let heightLeft=imgH, pos=0;
        pdf.addImage(img,"JPEG",0,pos,imgW,imgH,undefined,"FAST");
        heightLeft -= pageH;
        while(heightLeft>0){ pos = heightLeft - imgH; pdf.addPage(); pdf.addImage(img,"JPEG",0,pos,imgW,imgH,undefined,"FAST"); heightLeft -= pageH; }
        pdf.save("تقرير-حصص-الانتظار.pdf");
      });

      render();
    })();
  </script>
</body>
</html>

